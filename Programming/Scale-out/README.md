# [Scale out](https://github.com/kkobug/BTS/blob/main/DataBase/SQL%EA%B3%BCNoSQL/SQL_NoSQL.md#-%ED%99%95%EC%9E%A5-%EA%B0%9C%EB%85%90)

#### 데이터의 흐름

1. 사용자가 도메인 이름을 통해 웹사이트에 접속한다.
2. DNS 조회 결과에 따라 IP 주소가 반환된다.
3. IP주소로 HTTP 요청이 전달된다.
4. 요청받은 웹 서버는 HTML페이지 또는 JSON 데이터를 반환한다.

#### DB

- 데이터베이스 선택 : [RDB vs NoSQL](https://github.com/kkobug/BTS/blob/main/DataBase/SQL%EA%B3%BCNoSQL/SQL_NoSQL.md#3-sql-vs-nosql)
  - latency 요구사항에 따라
  - 데이터의 저장 용량에 따라
  - 데이터 구조에 따라

- Web Server : 클라이언트로부터 HTTP 요청을 받아 HTML, CSS 문서와 같은 정적 콘텐츠를 전달하는 컴퓨터
- Web Application Server : 비즈니스 로직이나 DB 조회와 같은 동적인 콘텐츠를 제공

---

#### Load Balancer

- 하위 서버들에게 트래픽을 고르게 분산해주는 장치
- 클라이언트의 접속을 서버가 직접 처리하지 않는다.
- 한 서버에 장애가 생기더라도 서비스가 중단되지 않아 가용성이 향상된다.
- 서버에 부하가 걸리더라도, 서버를 로드밸런서 하위에 추가하여 부하를 해소할 수 있다.

#### DB 다중화

- master DB, slave DB 를 나누어 관리한다.
- 원본은 master DB에, 사본은 slave DB에 저장한다.
- CUD 연산은 master DB에서만 지원하며, R 연산은 slave DB에서만 지원한다.
- 대부분의 application은 읽기연산의 비중이 지배적이므로 slave DB의 수를 더 많게 관리한다.
- 장점
  - 성능 개선 : 읽기 연산을 slave DB로 분산시켜 쿼리를 병렬로 처리하므로 성능이 개선된다.
  - 안정성 : DB 일부가 유실되어도 사본이 있으므로 데이터를 보존할 수 있다.
  - 가용성 : 하나의 DB에 장애가 발생하더라도 다른 서버의 데이터를 이용하여 서비스를 유지할 수 있다.

#### [캐시](https://github.com/kkobug/BTS/tree/main/Computer%20Science/Cache)

- 사용 시 유의사항
  - 적절성 : 갱신이 자주 일어나지 않고, 참조가 빈번할 경우 적용한다.
  - 일관성 : 실제 데이터와 캐시 데이터가 동일해야한다.
  - 생명주기(만료) : 데이터의 만료주기가 너무 짧으면 캐시의 효과가 적게 나타나며, 만료주기가 너무 길거나 만료되지 않으면 데이터가 갱신되지 않아 일관성이 깨질 수 있다.
  - 메모리 : 캐시 메모리의 크기가 너무 작으면 캐시 데이터를 자주 삭제해주어야 하며, 서비스에 문제를 야기할 수 있다.

#### [CDN](https://github.com/kkobug/BTS/tree/main/Computer%20Science/Cache#cdn)

- 사용 시 유의사항
  - 비용 : CDN으로 들어가고 나가는 데이터의 전송량에 따라 요금이 발생한다. 자주 사용되지 않는 정적데이터는 과도한 비용을 발생시킬 수 있다.
  - 생명주기(만료) : 캐시와 동일
  - CDN 장애 대처방안 : CDN이 복구되기 까지 서비스가 지속될 수 있도록 대처방안이 필요하다.

#### stateless 웹 계층

- 수평적으로 확장된 서비스에서 사용자의 상태정보는 분산되어있지 않아야함
- 사용자의 상태정보를 저장하기 위해서 데이터를 관리한다.
- 사용자의 세션 정보, 프로필 이미지 등 상태정보 등을 저장

#### DB sharding

- DB를 shard 단위로 분할하는 기술
- 데이터를 분할하여 관리하는 만큼 효율을 높일 수 있다.
- 하나의 DB를 쪼개어 관리하는 만큼, 여러 데이터를 조인하기 어려운 문제가 발생한다. DB를 비정규화하여 하나의 테이블에서 쿼리가 수행될 수 있도록 할 수 있다.

### Summary

- 서버, DB를 포함한 모든 계층에 다중화(로드밸런서, DB 다중화, 샤딩) 도입할 것
- 가능한 한 많은 데이터를 캐시할 것
- 정적 콘텐츠는 CDN을 통해 서비스할 것
- 무상태 웹 계층을 만들어 관리할 것

---

Alex Xu, 『가상 면접 사례로 배우는 대규모 시스템 설계 기초』, 이병준 옮김, 인사이트(2021), p1-p31.