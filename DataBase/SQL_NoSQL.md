# SQL, NoSQL

### 1. SQL 이란?

- Structured Query Language(구조적 질의 언어)로, RDBMS에서 자료 관리 및 처리를 위해 설계된 언어이다.

####  1) SQL의 특징

```
1. 영어 문장과 비슷한 구문을 갖추고 있어서 쉽게 배우고 사용할 수 있는 언어
2. 표준 SQL 문법이 존재해 DBMS 종류(Oracle, Mysql 등)에 얽매이지 않고 사용가능
3. 프로그래밍 언어들처럼 절차적인 개별 단위로 처리되지 않고, 데이터의 집합 단위로 처리된다. 이러한 특징 덕분에 SQL문장을 작성하는 사람은 데이터가 어떻게 처리되는지에 대한 과정은 신경쓰지 않아도 됨
4. 데이터의 구조가 NoSQL보다 엄격
```



#### 	2) SQL 문법 종류

```
1. DDL(Data Definition Language, 데이터 정의 언어)
	- 각 릴레이션을 정의하기 위해 사용하는 언어
	- CREATE, ALTER, DROP 등
2. DML(Date Manipulate Language, 데이터 조작 언어)
	- 데이터를 관리하기 위한 언어 (수정/추가/삭제)
	- SELECT, INSERT,UPDATE 등
3. DCL(Data Contral Language, 데이터 제어 언어)
	- 관리하고 접근하는 권한을 다루기 위한 언어
	- GRANT, REVOKE 등
```



#### 3) SQL 의 장/단점

```
장점
	1. 명확하게 정의된 스키마, 데이터 무결성 보장
	2. 관계는 각 데이터를 중복없이 한번만 저장
단점
	1. 데이터의 구조가 엄격하다. 데이터 스키마를 사전에 계획해야한다.
	2. 관계를 맺고 있어서 조인문이 많은 복잡한 쿼리가 만들어질 수 있다.
	3. 대체로 수직적 확장만 가능
```





### 2. NoSQL이란?

- Not only SQL의 약자, 비관계형 데이터베이스

#### 1) NoSQL의 특징

```
1. 데이터간의 관계를 정의하지 않는다.
2. 대용량의 데이터를 저장할 수 있다.
3. 기존의 관계형 데이터베이스보다 더 융통성있는 데이터 모델을 사용하고 데이터의 저장 및 검색을 위한 특화된 메커니즘을 제공
```



#### 2) NoSQL 종류

##### 1. Document DB

예시)

<a href='https://ifh.cc/v-MKx4p1' target='_blank'><img src='https://ifh.cc/g/MKx4p1.png' border='0'></a>

- 데이터를 json document 형태로 저장
- 보통의 SQL처럼 행과 열이 존재하는 것이 아님.
- 여러개의 테이블을 하나의 Document 내에 모아둘 수 있음 - 조회시 한번의 조회로 필요한 데이터 획득. Join기능을 대체
- 어떤 종류의 어떤 모양의 데이터든 저장할 수 있다. 즉, 데이터가 같은 모양일 필요가 없다.
- 사용사례
  - 각 문서가 고유하고 시간에 따라 진화하는 콘텐츠 관리 시스템
  - 사용자 프로파일 및 카탈로그



- 종류
  - mongo DB
    - 데이터 입출력에는 JSON형식을 사용하고 데이터를 저장할때는 BSON(Binary JSON)형태로 변환합니다. 데이터 검색 전 파싱이 필요하여 검색속도가 느린 점을 보완하기위해 mongoDB가 자동으로 이진 형식으로 저장합니다.
  - CouchDB



##### 2. Key-Value DB

예시)

<a href='https://ifh.cc/v-zj3Y4R' target='_blank'><img src='https://ifh.cc/g/zj3Y4R.png' border='0'></a>

- 구조를 정하지않고. key만 겹치지 않게 넣은 다음 최대한 flexible하게 value를 넣을 수있는 데이터베이스. key로 value를 찾을 수 있지만. 구체적인 검색은 불가.
- value의 기본타입은 string이며, container타입(Hash, list, set 등)의 데이터를 넣을 수 있다.
- 단, DocumentDB보다 얻을 수 있는 데이터가 제한적. 저장하기전에 DB에서 무엇을 받을지 고민해야한다.
- 테이블간 조인을 고려하지 않으므로 RDB(Relational Database)에서 관리하는 외부키나, 컬럼별 constraints등이 필요 없다.
- 값에 모든 데이터 타입을 허용, 그래서 개발자들이 데이터 입력 단계에서 검증 로직을 제대로 구현하는 것이 중요하다.
- 간단한 데이터 모델을 대상으로 데이터를 자주 읽고 쓰는 애플리케이션에 적합. 값은 boolean이나 integer값 처럼 단순한 스칼라 값이 일반적, but 리스트나 json 같은 구조화된 값도 가능
- 애플, 넷플릭스, 인스타그램, 우버 등에서 많이 쓴다.

- 사용 사례
  - 세션 스토어
  - 장바구니
  - 좋아요 표시 및 취소
  - 개별 이벤트 페이지 방문 횟수 저장

- 종류
  - Redis
  - Riak
  - Oracle Berkely
  - AWS DynamoDB



##### 3. Graph DB

예시)

<a href='https://ifh.cc/v-MKx4p1' target='_blank'><img src='https://d1.awsstatic.com/diagrams/foaf-graph.e5e42865e0ee97a2972f9014d28f525ef68a981b.png' border='0'></a>



- 노드를 사용하여 데이터 엔터티를 저장하고 엣지로는 엔터티 간의 관계를 저장
- 엣지는 항상 시작 노드, 끝 노드, 유형과 방향을 가지며, 상-하위 관계, 동작, 소유자 등을 문서화

- column이나 document가 필요없고, 각 노드간의 관계를 알아야할 때
  - 예 ) 페이스북에서 만든 Tao
      - 각각의 entity를 저장하고, 이를 관계망으로 연결.
      - 유저1이 사진1 좋아요, 유저1과 유저2는 친구이다 등등.
- 사용 사례
  - 이상 탐지
  - 추천 엔진



#### 3) NoSQL 의 장/단점

```
장점
	1. 유연한 구조를 가지고 있다. 언제든지 저장된 데이터를 조정하고 새로운 필드 추가 가능
	2. 데이터는 애플리케이션이 필요로하는 형식으로 저장됨. 데이터 읽는 속도 빠름.
	3. 수직 및 수평 확장이 가능
	4. 특별한 이슈에 대응하기 좋음
단점
	1. 유연한 구조에 의해 데이터 구조 결정을 미루게 될 수 있음
	2. 데이터 중복이 있을 수 있음
```





### 3. SQL vs NoSQL

```
SQL
1. 관계를 맺고 있는 데이터가 자주 변경되는 프로젝트의 경우 (NoSQL에선 여러 컬렉션을 모두 수정해야하기 때문에 비효율적)
2. 변경될 여지가 없고, 명확한 스키마가 사용자와 데이터에게 중요한 경우

NoSQL
1. 정확한 데이터 구조를 알 수 없거나 변경/확장 될 수 있는 경우
2. 읽기를 자주 하지만, 데이터 변경은 자주 없는 경우
3. DB를 수평으로 확장해야하는 경우 (막대한 양의 데이터를 다뤄야하는 경우)

결론 : 프로젝트의 형태에 따라 선택해서 사용하기
```





##### * 확장 개념

- 수직적 확장 : 단순히 dB서버의 성능을 향상시키는 것(SSD,CPU 등의 부품 추가 or 업그레이드)
- 수평적 확장 : 더 많은 서버가 추가됨에 따라 저장공간이 추가, DB가 전체적으로 분산





#### ⁉QnA

1. document DB는 json으로만 저장이 되나요?

​		아니요, 여기서 Document는 JSON 이나 XML같은 표준 형식을 말합니다.

2. 그래서 언제 SQL을 쓰는지 ? NoSQL을 쓰는지

​		대부분의 프로젝트에서는 SQL을 사용합니다. NoSQL을 어느경우에서 사용하는지 콕 집어서 얘기할 순 없지만 데이터가 NoSQL 의 		key-value DB, document DB등의 특징 및 장점을 확연히 타는 경우 NoSQL을 쓰면 됩니다.

3. 좋아요 취소의 경우에는 데이터 변경이 아닌가? NoSQL의 특징이 변경이 자주 없는 경우 사용한다고  하는데 좋아요를 취소하는 경우는 어떻게 하는가?

   Key-Value DB의 응용영역에는 타임라인을 표시하는 웹 어플리케이션 혹은 배열 형식 데이터에 빈번한 추가/삭제가 일어나는 경우가 있습니다. 따라서 Key-Value DB를 사용하면 됩니다.

4. SQL은 왜 수평적 확장이 되지 않는가?

​		SQL에서 데이터가 저장되는 방식(스키마, 관계 기반으로 저장) 때문에 관계형 데이터베이스는 일반적으로 수직적 확장만을 지원합니다. 관계형 데이터베이스에서는 같은 테이블 스키마를 가진 데이터를 다수의 데이터베이스에 분산하여 저장하는 방식인 '(*)샤딩'을 활용해서 데이터를 저장해서 활용 할 수 있지만 구현하기가 대체로 어렵습니다.

- 샤딩 : 관계형 데이터베이스에서 대량의 데이터를 처리하기 위해서 데이터를 파티셔닝 하는 기술. DBMS 레벨에서 데이터를 나누는 것이 아니고 **데이터베이스 자체를 분할하는 방식**입니다. 

  예를 들면, 현재 운영 중인 서비스가 해외로도 진출을 하게 되어서 더 큰 데이터 베이스가 필요하게 되면 이때 한국 유저의 정보는 A 데이터 베이스를 이용하고 유럽 쪽의 데이터베이스는 B 데이터 베이스에 저장하는 것입니다.







- 참고

  - https://aws.amazon.com/ko/nosql/
  - https://jaemunbro.medium.com/nosql-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B9%EC%84%B1-%EB%B9%84%EA%B5%90-c9abe1b2838c

  - https://newtoner.tistory.com/23
  - https://codingjuny.tistory.com/55